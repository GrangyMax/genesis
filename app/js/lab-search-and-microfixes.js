$(document).ready(()=>{const t="/wp-admin/admin-ajax.php";async function e(e,i,n,s){return function(t){if(!t)return null;let e="";for(const n of t)e+=`\n          <a href="${n.serviceLink}"\n            class="list-group-item list-group-item-action flex-column align-items-start block-lab pt-1">\n            <div class="pr-2 pl-2">\n                <div class="d-flex w-100 justify-content-between block-title-lab pt-3">\n                    <h3 class="lab-tabs__title mb-2 text-blue">\n                        <i class="block-title-lab"></i>\n                        ${n.title}\n                    </h3>\n                </div>\n                <p class="mb-2 block-short-lab" >${n.description}</p>\n            </div>`,n.isHomeVisit&&(e+='\n                <small class="iconlab-page"><i class="icon-car"></i> Возможен выезд на дом</small>'),n.isStock&&(e+='\n                <small class="iconlab-page-red"><i class="icon-gift"></i> Акция</small>'),e+=`\n            <div class="lab-tabs__foot row p-2 pt-0 pb-0">\n            <span class="col pt-1 pb-2">\n                Цена: \n                <span class="lab-tabs__price">${i(n.price)}</span>\n            </span>\n            <span class="col-auto pt-1 pb-2">\n                <small class="lab-more">Подробнее</small>\n            </span>\n          </div>\n        </a>`;return e;function i(t){if("0"==t)return"Уточняйте";if(!/^\d+(\s?\-\s?\d+)?$/.test(t))return t||"Уточняйте";let e=[];return t.toString().split("-").forEach(t=>{t=t.trim();let i="",n=t.length;for(let e=n-1;e>-1;e--)i+=(n-e)%3!=0?t[e]:t[e]+" ";e.push(i.split("").reverse().join("")+RUBLE)}),`<span class="format-price">${e.join(" - ")}</span>`}}(await async function(e,i,n,s){let a;s?a=s:(a=`count=${e}&action=${i}`,n&&(a+=`&id=${n}`));console.log(`QUERY: ${t}:POST => ${a}`);const o=await fetch(t,{method:"POST",body:a,headers:{"Content-type":"application/x-www-form-urlencoded"}});let c;try{c=await o.clone().json()}catch(e){console.warn(`Error: When parsing JSON from server (${t}): \n`,(await o.text()).slice(0,100)+"..."),console.warn("Using default JSON"),c=[{price:1500,title:"title 1",description:"description1",serviceLink:"#",isHomeVisit:!0,isStock:!0},{price:2750,title:"title 2",description:"description2",serviceLink:"#",isHomeVisit:!1,isStock:!0},{price:1e3,title:"title 3",description:"description3",serviceLink:"#",isHomeVisit:!0,isStock:!1},{price:9500,title:"title 4",description:"description4",serviceLink:"#",isHomeVisit:!1,isStock:!1},{price:3e3,title:"title 5",description:"description5",serviceLink:"#",isHomeVisit:!0,isStock:!0}]}return c}(e,i,n,s))}const i={search:{action:"lab_search",searchString:"",counter:1,refresh(t){this.searchString=t,this.counter=1},increment(){this.counter++},async getHTML(){return console.log(`Searching HTML by loadManager: { counter: ${this.counter}, action: ${this.action}, search: ${this.searchString} }`),await e("","","",`count=${this.counter}&action=${this.action}&search=${this.searchString}`)}},tabs:{action:"labs_start",id:0,counter:1,refresh(t,e){this.action=t,this.id=e||"",this.counter=1},increment(){this.counter++},async getHTML(){return console.log(`Getting HTML by loadManager: { counter: ${this.counter}, action: ${this.action}, id: ${this.id} }`),await e(this.counter,this.action,this.id)}}},n="slow";$(".service-tab__content").each(function(){$(this).hide()});const s=$(".service-tab_root").toArray(),a=$(".tab-container"),o=$(".service-tabs-block"),c=a.find(".list-group.blocks-lab"),l={main:a.find(".preloader-main"),bottom:a.find(".preloader-bottom")};new IntersectionObserver(function(t){!0===t[0].isIntersecting&&(console.log(`Last load number: ${window.loadEndNumber}`),async function(){i.tabs.increment();const t=await i.tabs.getHTML();if(t){const e=$('<div class="list-group" style="display: none"></div>').html(t);c.append(e),e.slideDown(n)}else l.bottom.fadeOut(n)}())},{threshold:[1]}).observe(l.bottom[0]);for(const t of s){t.tabs=Array.from(t.querySelectorAll(".service-tab")),t.content=t.querySelector(".service-tab__content"),$(t).click(e=>{window.lastRootTab!=t?(window.lastRootTab&&b(lastRootTab),d(t)):h(t)});for(const e of t.tabs)$(e).click(t=>{t.stopPropagation(),window.lastSelectedTab!=e?(window.lastSelectedTab&&u(lastSelectedTab),p(e)):m(e)})}async function r(t="labs_start",e=""){c.hide(),l.bottom.hide(),l.main.fadeIn(n),i.tabs.refresh(t,e);const s=await i.tabs.getHTML();l.main.hide(),c.html(s),l.bottom.show(),c.fadeIn(n)}async function d(t){$(t).addClass("service-tab_active"),$(t.content).slideDown(n);let e=$(".service-tab__title",t)[0];window.lastRootTab=t,t.expanded=!0,await r(e.dataset.action)}async function b(t){$(t).removeClass("service-tab_active"),$(t.content).slideUp(n),t.expanded=!1,window.lastRootTab==t&&(window.lastRootTab=null),window.lastSelectedTab&&await u(lastSelectedTab)}async function h(t){t.expanded?(await b(t),await r()):d(t)}async function p(t){$(t).addClass("service-tab__service-single_active"),window.lastSelectedTab=t,t.selected=!0,await r(i.tabs.action,t.dataset.actionId)}async function u(t){$(t).removeClass("service-tab__service-single_active"),t.selected=!1,window.lastSelectedTab==t&&(window.lastSelectedTab=null)}async function m(t){t.selected?(await u(t),await r(i.tabs.action)):await p(t)}const w=$(".js-search-block-lab"),f=$(".search-result-block"),v=f.find(".list-group.blocks-lab"),g={main:f.find(".preloader-main"),bottom:f.find(".preloader-bottom")};new IntersectionObserver(function(t){!0===t[0].isIntersecting&&(console.log(`Last load number: ${window.loadEndNumber}`),async function(){i.search.increment();let t=await i.search.getHTML();if(!t)return void g.bottom.slideUp(n);const e=$('<div class="list-group" style="display: none"></div>').html(t);v.append(e),e.slideDown(n)}(w.val()))},{threshold:[1]}).observe(g.bottom[0]);let y=null;w.on("keyup",t=>{y&&clearTimeout(y),y=setTimeout(()=>(async function(t){if(!(t=t.trim()))return g.main.show(),a.fadeIn(n),o.fadeIn(n),f.hide(),v.hide(),void g.bottom.hide();g.main.show(),g.bottom.hide(),o.hide(),a.hide(),f.show(),v.slideUp(n),i.search.refresh(t);let e=await i.search.getHTML();e?g.bottom.show():e="<center>По вашему запросу ничего не найдено</center>";g.main.hide(),v.html(e),v.slideDown(n)})(w.val()),500)})});